<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Under Construction - Ameen Shaikh</title>
    <!-- Bootstrap CSS for basic styling and grid -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- Inter font for clean typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <style>
        /* General body styling for font and background matching your theme */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            margin: 0;
            display: flex; /* Use flexbox to center content */
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #f0f2f5 0%, #e0e6ec 100%); /* Matching gradient */
            color: #2c3e50; /* Dark text for contrast */
            text-align: center;
            overflow-y: auto; /* Allow vertical scrolling */
        }

        /* Main content container for the message */
        .content-wrapper {
            background-color: white;
            border-radius: 15px; /* Rounded corners */
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); /* Soft shadow */
            padding: 40px;
            max-width: 600px; /* Limit width for readability */
            margin: 20px; /* Ensure some margin on small screens */
            width: 100%; /* Responsive width */
        }

        /* Title styling matching your website's H2 */
        h1, h2 {
            font-weight: 700;
            color: #2c3e50;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 { font-size: 3.5rem; }
        h2 { font-size: 2.5rem; }

        /* Subtitle/message styling */
        p {
            font-size: 1.15rem;
            color: #6c757d; /* Grey text for body */
            margin-bottom: 30px;
        }

        /* Icon styling and animation */
        .construction-icon {
            font-size: 5rem; /* Large icon */
            color: #ff5722; /* Vibrant orange accent */
            margin-bottom: 20px;
            display: inline-block; /* Required for transform animations */
            animation: pulse 2s infinite ease-in-out; /* Apply pulse animation */
            cursor: pointer; /* Indicate it's clickable */
        }

        /* Keyframes for the pulsing animation */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Button styling matching your website's primary buttons */
        .btn-primary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); /* Blue gradient */
            border: none;
            border-radius: 25px; /* Rounded button */
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3); /* Button shadow */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px); /* Slight lift on hover */
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.4);
            background: linear-gradient(135deg, #0056b3 0%, #007bff 100%); /* Invert gradient on hover */
        }

        /* Game and Leaderboard Container Styles */
        #game-container, #leaderboard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            padding: 20px;
            max-width: 600px;
            margin: 20px;
            width: 100%;
        }

        canvas {
            border: 5px solid #2c3e50; /* Dark border matching text color */
            border-radius: 8px;
            background-color: #f7fafc; /* Light background for canvas */
            touch-action: none; /* Prevent default touch actions like scrolling/zooming */
        }

        #game-controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap; /* Allow buttons to wrap */
            justify-content: center;
            gap: 10px; /* Space between buttons */
        }
        
        #score-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 15px;
        }

        /* --- Glassy Blue Button Style Starts Here --- */
        #game-controls .btn-primary, .leaderboard-controls .btn-primary, #name-input-container .btn-primary {
            background: rgba(0, 123, 255, 0.2); /* Semi-transparent blue */
            backdrop-filter: blur(8px); /* Frosted glass blur */
            -webkit-backdrop-filter: blur(8px); /* Safari support */
            border: 1px solid rgba(0, 123, 255, 0.3); /* Subtle blue border */
            box-shadow: 0 8px 32px 0 rgba(0, 123, 255, 0.15); /* Soft blue shadow */
            color: black; /* Black text */
        }

        #game-controls .btn-primary:hover, .leaderboard-controls .btn-primary:hover, #name-input-container .btn-primary:hover {
            background: rgba(0, 123, 255, 0.4);
            box-shadow: 0 8px 32px 0 rgba(0, 123, 255, 0.25);
            transform: translateY(-2px);
            color: black;
        }

        .game-control-button {
            background: rgba(0, 123, 255, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(0, 123, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(0, 123, 255, 0.15);
            color: black; /* Black icon for contrast */
            border-radius: 12px;
            padding: 15px 20px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.1s ease;
            width: 80px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-control-button:active {
            transform: scale(0.95);
            background: rgba(0, 123, 255, 0.4); /* Darken slightly on press */
        }
        /* --- Glassy Button Style Ends Here --- */

        /* Arrow button grid layout */
        .arrow-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 5px;
            width: 200px;
            margin: 10px auto;
        }
        .arrow-controls .game-control-button { grid-column: 2; }
        .arrow-controls .game-control-button:nth-child(1) { grid-row: 1; } /* Up */
        .arrow-controls .game-control-button:nth-child(2) { grid-row: 2; grid-column: 1; } /* Left */
        .arrow-controls .game-control-button:nth-child(3) { grid-row: 2; grid-column: 3; } /* Right */
        .arrow-controls .game-control-button:nth-child(4) { grid-row: 3; } /* Down */

        /* Leaderboard styles */
        #leaderboard-list {
            list-style: none;
            padding: 0;
            width: 80%;
        }
        #leaderboard-list li {
            background-color: #f0f2f5;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            font-weight: 700;
        }

        #name-input-container {
            margin-top: 20px;
        }
        #player-name-input {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #007bff;
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; }
            h2 { font-size: 2rem; }
            .content-wrapper, #game-container, #leaderboard-container { padding: 20px; }
            .construction-icon { font-size: 4rem; }
            p { font-size: 1rem; }
            canvas { width: 95%; height: auto; }
            .arrow-controls { display: grid; }
        }
        @media (min-width: 769px) {
            .arrow-controls { display: none; }
        }
    </style>
</head>
<body>
    <div class="content-wrapper" id="construction-content">
        <i class="fas fa-tools construction-icon" id="play-game-icon"></i>
        <h1>Under Construction</h1>
        <p>We're busy building something amazing! Please check back soon for updates.</p>
        <a href="#" id="view-leaderboard-btn" class="btn btn-primary">View Leaderboard</a>
    </div>

    <div id="game-container" style="display: none;">
        <div id="score-display">Score: 0</div>
        <canvas id="snakeGameCanvas" width="400" height="400"></canvas>
        <div id="game-over-message" style="display: none;"></div>
        <div id="name-input-container" style="display: none;">
            <p>High Score! Enter your name:</p>
            <input type="text" id="player-name-input" placeholder="Your Name" maxlength="10">
            <button class="btn btn-primary" id="submit-score-btn">Submit</button>
        </div>
        <div id="game-controls">
            <div class="arrow-controls">
                <button class="game-control-button" id="up-btn"><i class="fas fa-arrow-up"></i></button>
                <button class="game-control-button" id="left-btn"><i class="fas fa-arrow-left"></i></button>
                <button class="game-control-button" id="right-btn"><i class="fas fa-arrow-right"></i></button>
                <button class="game-control-button" id="down-btn"><i class="fas fa-arrow-down"></i></button>
            </div>
            <button class="btn btn-primary" id="restart-game-btn" style="display: none;">Restart Game</button>
            <button class="btn btn-primary" id="back-to-construction-btn">Back</button>
        </div>
    </div>

    <div id="leaderboard-container" style="display: none;">
        <h2>Leaderboard</h2>
        <ol id="leaderboard-list"></ol>
        <div class="leaderboard-controls" style="margin-top: 20px;">
            <button class="btn btn-primary" id="back-from-leaderboard-btn">Back</button>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, getDocs, deleteDoc, doc, limit, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Initialization ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "your-api-key", authDomain: "your-auth-domain", projectId: "your-project-id" };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let userId = null;
        let leaderboardCol;

        // --- jQuery Ready Function ---
        $(document).ready(function() {
            // --- DOM Elements ---
            const constructionContent = $('#construction-content');
            const gameContainer = $('#game-container');
            const leaderboardContainer = $('#leaderboard-container');
            const playGameIcon = $('#play-game-icon');
            const backToConstructionBtn = $('#back-to-construction-btn');
            const restartGameBtn = $('#restart-game-btn');
            const scoreDisplay = $('#score-display');
            const canvas = $('#snakeGameCanvas')[0];
            const ctx = canvas.getContext('2d');
            const viewLeaderboardBtn = $('#view-leaderboard-btn');
            const backFromLeaderboardBtn = $('#back-from-leaderboard-btn');
            const leaderboardList = $('#leaderboard-list');
            const nameInputContainer = $('#name-input-container');
            const playerNameInput = $('#player-name-input');
            const submitScoreBtn = $('#submit-score-btn');

            // --- Game Variables ---
            const gridSize = 20;
            let snake, food, dx, dy, score, gameInterval, gameStarted, changingDirection;
            const MAX_LEADERBOARD_ENTRIES = 5;
            let leaderboard = [];

            // --- Authentication ---
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    userId = user.uid;
                    // Path for public leaderboard data
                    const leaderboardPath = `/artifacts/${appId}/public/data/leaderboard`;
                    leaderboardCol = collection(db, leaderboardPath);
                    listenForLeaderboardUpdates();
                } else {
                    signInAnonymously(auth).catch((error) => {
                        console.error("Anonymous sign-in failed:", error);
                    });
                }
            });

            // --- Leaderboard Functions (Firestore) ---
            function listenForLeaderboardUpdates() {
                if (!leaderboardCol) return;
                // Note: Firestore requires an index for ordering. If you get an error in the console,
                // it will provide a link to create the necessary index in your Firebase console.
                const q = query(leaderboardCol, orderBy("score", "desc"), limit(MAX_LEADERBOARD_ENTRIES));
                
                onSnapshot(q, (snapshot) => {
                    leaderboard = [];
                    snapshot.forEach((doc) => {
                        leaderboard.push({ id: doc.id, ...doc.data() });
                    });
                    renderLeaderboard();
                    pruneLeaderboard(); // Clean up old scores
                });
            }

            function renderLeaderboard() {
                leaderboardList.empty();
                if (leaderboard.length === 0) {
                    leaderboardList.append('<li>No scores yet. Be the first!</li>');
                    return;
                }
                leaderboard.forEach(entry => {
                    leaderboardList.append(`<li><span>${entry.name}</span><span>${entry.score}</span></li>`);
                });
            }
            
            async function pruneLeaderboard() {
                 const allScoresQuery = query(leaderboardCol, orderBy("score", "desc"));
                 const snapshot = await getDocs(allScoresQuery);
                 if (snapshot.size > MAX_LEADERBOARD_ENTRIES) {
                     const promises = [];
                     for(let i = MAX_LEADERBOARD_ENTRIES; i < snapshot.docs.length; i++) {
                         promises.push(deleteDoc(doc(leaderboardCol, snapshot.docs[i].id)));
                     }
                     await Promise.all(promises);
                 }
            }


            function isHighScore(currentScore) {
                if (currentScore === 0) return false;
                const lowestScore = leaderboard.length < MAX_LEADERBOARD_ENTRIES ? 0 : leaderboard[MAX_LEADERBOARD_ENTRIES - 1].score;
                return currentScore > lowestScore;
            }

            async function addScoreToLeaderboard(name, newScore) {
                if (!leaderboardCol) return;
                try {
                    await addDoc(leaderboardCol, {
                        name: name,
                        score: newScore,
                        timestamp: new Date()
                    });
                } catch (e) {
                    console.error("Error adding document: ", e);
                }
            }
            
            // --- Game Functions ---
            function initGameVars() {
                snake = [{ x: 10 * gridSize, y: 10 * gridSize }];
                dx = gridSize; dy = 0; score = 0;
                gameStarted = false; changingDirection = false;
            }

            function generateFood() {
                food = {
                    x: Math.floor(Math.random() * (canvas.width / gridSize)) * gridSize,
                    y: Math.floor(Math.random() * (canvas.height / gridSize)) * gridSize
                };
                while (snake.some(segment => segment.x === food.x && segment.y === food.y)) {
                    generateFood();
                }
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#e53e3e'; ctx.strokeStyle = '#a00';
                ctx.fillRect(food.x, food.y, gridSize, gridSize);
                ctx.strokeRect(food.x, food.y, gridSize, gridSize);
                ctx.fillStyle = '#10b981'; ctx.strokeStyle = '#086';
                snake.forEach(segment => {
                    ctx.fillRect(segment.x, segment.y, gridSize, gridSize);
                    ctx.strokeRect(segment.x, segment.y, gridSize, gridSize);
                });
            }

            function update() {
                if (!gameStarted) return;
                changingDirection = false;
                const head = { x: snake[0].x + dx, y: snake[0].y + dy };
                if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height || snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    endGame();
                    return;
                }
                snake.unshift(head);
                if (head.x === food.x && head.y === food.y) {
                    score += 10;
                    scoreDisplay.text(`Score: ${score}`);
                    generateFood();
                } else {
                    snake.pop();
                }
                draw();
            }

            function startGame() {
                initGameVars(); gameStarted = true;
                scoreDisplay.text(`Score: ${score}`);
                generateFood();
                restartGameBtn.hide();
                nameInputContainer.hide();
                $('#game-controls').show();
                if (gameInterval) clearInterval(gameInterval);
                gameInterval = setInterval(update, 100);
                draw();
            }

            function showGameOverScreen() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '30px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('Game Over!', canvas.width / 2, canvas.height / 2 - 20);
                ctx.font = '20px Inter';
                ctx.fillText(`Final Score: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
                restartGameBtn.show();
            }

            function endGame() {
                gameStarted = false;
                clearInterval(gameInterval);
                if (isHighScore(score)) {
                    $('#game-controls').hide();
                    nameInputContainer.show();
                } else {
                    showGameOverScreen();
                }
            }

            // --- Event Listeners ---
            playGameIcon.on('click', () => { constructionContent.hide(); gameContainer.show(); startGame(); });
            viewLeaderboardBtn.on('click', () => { renderLeaderboard(); constructionContent.hide(); leaderboardContainer.show(); });
            backFromLeaderboardBtn.on('click', () => { leaderboardContainer.hide(); constructionContent.show(); });
            backToConstructionBtn.on('click', () => { gameContainer.hide(); constructionContent.show(); if (gameInterval) clearInterval(gameInterval); gameStarted = false; });
            restartGameBtn.on('click', startGame);

            submitScoreBtn.on('click', async () => {
                const playerName = playerNameInput.val().trim();
                if (playerName) {
                    await addScoreToLeaderboard(playerName, score);
                    nameInputContainer.hide();
                    $('#game-controls').show();
                    showGameOverScreen();
                    playerNameInput.val('');
                } else {
                    alert('Please enter a name!');
                }
            });

            // --- Keyboard & Touch Controls ---
            $(document).on('keydown', e => {
                if (!gameStarted || changingDirection) return;
                const keyPressed = e.key, goingUp = dy === -gridSize, goingDown = dy === gridSize, goingLeft = dx === -gridSize, goingRight = dx === gridSize;
                if ((['ArrowLeft', 'a'].includes(keyPressed)) && !goingRight) { dx = -gridSize; dy = 0; changingDirection = true; } 
                else if ((['ArrowUp', 'w'].includes(keyPressed)) && !goingDown) { dx = 0; dy = -gridSize; changingDirection = true; } 
                else if ((['ArrowRight', 'd'].includes(keyPressed)) && !goingLeft) { dx = gridSize; dy = 0; changingDirection = true; } 
                else if ((['ArrowDown', 's'].includes(keyPressed)) && !goingUp) { dx = 0; dy = gridSize; changingDirection = true; }
            });
            $('#up-btn').on('click', () => { if (!gameStarted || changingDirection || dy === gridSize) return; dx = 0; dy = -gridSize; changingDirection = true; });
            $('#down-btn').on('click', () => { if (!gameStarted || changingDirection || dy === -gridSize) return; dx = 0; dy = gridSize; changingDirection = true; });
            $('#left-btn').on('click', () => { if (!gameStarted || changingDirection || dx === gridSize) return; dx = -gridSize; dy = 0; changingDirection = true; });
            $('#right-btn').on('click', () => { if (!gameStarted || changingDirection || dx === -gridSize) return; dx = gridSize; dy = 0; changingDirection = true; });

        });
    </script>
</body>
</html>
